// ==UserScript==
// @name         高级求职助手，支持前程无忧、智联招聘、BOSS直聘、拉钩、猎聘
// @namespace    https://github.com/qq943260285
// @version      0.1
// @description  1.快捷添加企业黑名单；2.支持正则表达式黑名单；3.支持前程无忧、智联招聘、BOSS直聘;4.各大网站黑名单数据连通。
// @author       小宇专属(943260285@qq.com)
// @license      GPL-3.0-only
// @create       2019-3-25
// @match        *://search.51job.com/*
// @match        *://sou.zhaopin.com/*
// @match        *://www.zhipin.com/*
// @match        *://www.lagou.com/*
// @match        *://www.liepin.com/*
// @require      https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js
// @grant        GM_getValue
// @grant        GM.getValue
// @grant        GM_setValue
// @grant        GM.setValue
// @grant		 GM_addStyle
// ==/UserScript==
"use strict";
!function () {
    function n(n, o) {
        p.css({
            "pointer-events": "auto",
            "background-color": "rgba(55,55,55,.6)"
        }), g.show(500), g.find(".xyzs-modal-header-inner").text(n), g.find(".xyzs-modal-body").empty().append(o)
    }

    function o() {
        h.HtmlToList().each(function (n, o) {
            var e = !0, t = h.NameJqToNameText(h.ItemToNameJq(o));
            if (y.indexOf(t) > -1) e = !1, console.log("indexOf过滤," + t); else for (var i = 0; i < y.length; i++) if (new RegExp(y[i], "i").test(t)) {
                e = !1, console.log(y[i] + "正则表达式过滤," + t);
                break
            }
            e ? $(o).show() : $(o).hide()
        })
    }

    function e(n) {
        n += "", -1 === y.indexOf(n) ? (console.log("加入黑名单," + n), y.push(n), GM_setValue(b, JSON.stringify(y))) : console.log("已存在黑名单," + n), o()
    }

    function t(n) {
        y.indexOf(n) > -1 && (y.splice(y.indexOf(n), 1), GM_setValue(b, JSON.stringify(y))), o()
    }

    function i() {
        h.HtmlToList().each(function (n, o) {
            h.ItemToNameJq(o).after($('<div title="加入黑名单" style="' + h.DleButtonStyle + '" class="xyzs-del-div"><i class="fa fa-trash xyzs-del-ico"></i></div>').click(function () {
                return e(h.NameJqToNameText(h.ItemToNameJq(h.DleButtonToItem(this)))), !1
            }))
        })
    }

    var l = !0, s = !0, a = $("body");
    a.before('<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />'), a.before("<style>\n            .xyzs-tool-region{\n            position: fixed;\n             z-index: 20480;\n             left: 0;\n             top: 0;\n             width: 100%;\n             height: 100%;\n            }\n            .xyzs-tool{\n             background-color: #ff5c4c;\n             width: 50px;\n             height: 50px;\n             border-radius:25px;\n             -moz-border-radius:25px; /* Old Firefox */\n             position: absolute;\n             left: 10px;\n             bottom: 10px;\n             cursor: move;\n             pointer-events:auto;\n             -moz-box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);;\n             -webkit-box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);\n             box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);\n            }\n            .xyzs-tool .menu{\n            width: 200px;\n            height: 50px;\n            position: absolute;\n            left: 50px;\n            display: none;\n            transition: display 3s;\n            padding: 0 10px;\n            }\n            .xyzs-tool .fa-tool{\n             font-size: 27px;\n             color: #FFF!important;\n            }\n            .xyzs-menu-item{\n            height: 30px;\n            width: 30px;\n            border-radius:15px;\n            float: left;\n            margin: 10px;\n            background-color: #ff5c4c;\n             -moz-box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);;\n             -webkit-box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);\n             box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);\n             text-align: center;\n            }\n            .xyzs-menu-item:hover{\n             -moz-box-shadow:1px 1px 15px rgb(35,35,35);\n             -webkit-box-shadow:1px 1px 15px rgb(35,35,35);\n             box-shadow:1px 1px 15px rgb(35,35,35);\n            }\n            .xyzs-menu-item .fa-item{\n                font-size: 20px;\n                margin: auto 0;\n                width: 30px;\n                height: 30px;\n                line-height: 30px;\n                cursor: pointer;\n                color: #fff;\n            }\n            .xyzs-menu-item .fa-item:hover{\n\n            }\n            /*===== win =====*/\n            .xyzs-win{\n                width: 500px;\n                margin: 0 auto;\n                position: relative;\n                outline: 0;\n                top: 100px;\n                pointer-events:auto;\n            }\n            .xyzs-modal-content{\n                border-radius: 5px;\n                background-clip: padding-box;\n                background-color: #fff;\n                -moz-box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);;\n                -webkit-box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);\n                box-shadow:1px 1px 10px rgba(82, 82, 82, 0.74);\n                pointer-events:auto;\n                border: solid 1px #ff5c4c;\n            }\n            .xyzs-modal-close{\n                z-index: 1;\n                position: absolute;\n                right: 12px;\n                top: 8px;\n                overflow: hidden;\n                cursor: pointer;\n            }\n            .xyzs-icon-ios-close{\n                font-size: 25px;\n                color: #999;\n            }\n            .xyzs-modal-header{\n                border-bottom: 1px solid #e8eaec;\n                padding: 10px 16px;\n                text-align: left;\n                font-size: 15px;\n                font-weight: bold;\n                font-family: cursive;\n            }\n            .xyzs-modal-body{\n                padding: 16px;\n                font-size: 12px;\n            }\n\n            .xyzs-enterprise-list{\n                width: 100%;\n                height: 300px;\n                overflow-y: auto;\n                overflow-x: hidden;\n            }\n            .xyzs-enterprise-item{\n                /*height: 20px;*/\n                line-height: 20px;\n                margin: 5px;\n                font-size: 12px;\n                padding: 5px 12px;\n                border: solid 1px #dedede;\n            }\n            .xyzs-enterprise-item-ico{\n                color: #ff5c4c;\n                float: right;\n                font-size: 18px;\n            }\n\n            .xyzs-scrollbar::-webkit-scrollbar-track {\n              -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\n              background-color: #F5F5F5;\n              border-radius:5px\n            }\n\n            .xyzs-scrollbar::-webkit-scrollbar {\n              width: 10px;\n              background-color: #F5F5F5;\n            }\n\n            .xyzs-scrollbar::-webkit-scrollbar-thumb {\n              background-color: rgba(255,92,76,0.7);\n              border-radius:5px\n            }\n            .xyzs-scrollbar::-webkit-scrollbar-thumb:hover {\n              background-color: #ff5c4c;\n            }\n            /*=== 功能 ===*/\n            .xyzs-del-div{\n                color: #ff5c4c;\n                font-size: 20px;\n                cursor: pointer;\n            }\n            .xyzs-del-ico{\n            \n                color: #ff5c4c!important;\n            }\n        </style>");
    var c = !1, r = {x: 0, y: 0}, x = {x: 0, y: 0},
        p = $('<div class="xyzs-tool-region"></div>').mousedown(function () {
            p.css("pointer-events", "auto")
        }).mouseup(function () {
            c = !1, p.css("pointer-events", "none")
        }).mousemove(function (n) {
            if (c) {
                var o = n.originalEvent.x || n.originalEvent.layerX || 0,
                    e = n.originalEvent.y || n.originalEvent.layerY || 0, t = d.position().top, i = d.position().left,
                    s = $(window).height(), a = $(window).width();
                x.x = i, x.y = t;
                var p = i + o - r.x, g = s - 50 - t - e + r.y;
                d.css({
                    left: (p < 0 ? 0 : p + 50 > a ? a - 50 : p) + "px",
                    bottom: (g < 0 ? 0 : g + 50 > s ? s - 50 : g) + "px"
                }), l === a / 2 < i + 25 && (u.css({
                    width: 50 * m.length + 20 + "px",
                    left: (a / 2 < i + 25 ? -1 * (50 * m.length + 20) : 50) + "px"
                }), m.reverse(), f(), l = !l), r.x = o, r.y = e
            }
        }).css("pointer-events", "none"),
        d = $('\n        <div class=\'xyzs-tool\'>\n        <div style="position: absolute;text-align: center;width: 50px;top: 10px;color: #fff;">\n        <i class="fa fa-wrench fa-tool" title="工具箱"></i>\n        </div>\n        </div>').mouseleave(function () {
            u.hide(70)
        }).mouseenter(function () {
            u.show(70)
        }).mousedown(function (n) {
            c = !0, s = !0, p.css("pointer-events", "auto"), r.x = n.originalEvent.x || n.originalEvent.layerX || 0, r.y = n.originalEvent.y || n.originalEvent.layerY || 0
        }).mousemove(function () {
            s = !1
        }).click(function () {
            s && u.toggle()
        }).css({left: "10px", bottom: "10px"}), m = [{
            ico: "fa-eye-slash", title: "黑名单", callback: function () {
                console.log("黑名单");
                var o = $('\n                    <div class="xyzs-enterprise-list xyzs-scrollbar" ></div>\n                ');
                $.each(y, function (n, e) {
                    o.append($('<div class="xyzs-enterprise-item">' + e + "</div>").append($('<i class="fa fa-times xyzs-enterprise-item-ico" title="删除" item-name="' + e + '"></i>').click(function () {
                        t($(this).attr("item-name")), $(this).closest(".xyzs-enterprise-item").remove()
                    })))
                }), n("黑名单", o)
            }
        }, {
            ico: "fa-cog", title: "设置", callback: function () {
                console.log("设置")
            }
        }, {
            ico: "fa-podcast", title: "博客", callback: function () {
                console.log("博客")
            }
        }, {
            ico: "fa-github", title: "github", callback: function () {
                console.log("github")
            }
        }], u = $("\n    <div id='xyzs-menu' class='menu'>\n    </div>\n    ").css({width: 50 * m.length + 20 + "px"}),
        f = function () {
            u.empty();
            for (var n = 0; n < m.length; n++) !function (n) {
                u.append($('<div class="xyzs-menu-item"><i class="fa ' + m[n].ico + ' fa-item " title="' + m[n].title + '"></i></div>').click(function () {
                    m[n].callback()
                }))
            }(n)
        };
    f(), d.append(u), p.append(d), a.append(p);
    var g = $('\n        <div class="xyzs-win">\n            <div class="xyzs-modal-content">\n                <div class="xyzs-modal-close">\n                    <i title="关闭" class="fa fa-remove xyzs-icon-ios-close"></i>\n                </div>\n                <div class="xyzs-modal-header">\n                    <div class="xyzs-modal-header-inner">标题</div>\n                </div>\n                <div class="xyzs-modal-body">\n                    内容\n                </div>\n            </div>\n        </div>\n    ').hide();
    g.find(".xyzs-modal-close").click(function () {
        g.hide(), p.css({"background-color": ""})
    }), p.append(g);
    var b = "blacklist", y = GM_getValue(b) ? JSON.parse(GM_getValue(b)) : [], h = {
        WebUrl: null,
        HtmlToList: null,
        ItemToNameJq: null,
        NameJqToNameText: null,
        DleButtonToItem: null,
        DleButtonStyle: null
    }, v = [{
        WebUrl: "search.51job.com", HtmlToList: function () {
            return $(".el .t2 a[title]").closest(".el")
        }, ItemToNameJq: function (n) {
            return $(n).find(".t2 a[title]")
        }, NameJqToNameText: function (n) {
            return $(n).attr("title")
        }, DleButtonToItem: function (n) {
            return $(n).closest(".el")
        }, DleButtonStyle: "margin: 0 10px;display: inline-table;"
    }, {
        WebUrl: "sou.zhaopin.com", HtmlToList: function () {
            return $("#listContent .clearfix .commpanyName a[title]").closest(".clearfix")
        }, ItemToNameJq: function (n) {
            return $(n).find(".commpanyName a[title]")
        }, NameJqToNameText: function (n) {
            return $(n).attr("title")
        }, DleButtonToItem: function (n) {
            return $(n).closest(".clearfix")
        }, DleButtonStyle: "margin: 0 10px;display: inline-table;"
    }, {
        WebUrl: "www.zhipin.com", HtmlToList: function () {
            return $(".company-text h3 a[ka]").closest("li")
        }, ItemToNameJq: function (n) {
            return $(n).find(".company-text h3 a[ka]")
        }, NameJqToNameText: function (n) {
            return $(n).text()
        }, DleButtonToItem: function (n) {
            return $(n).closest("li")
        }, DleButtonStyle: "margin: 0 10px;display: inline-table;"
    }, {
        WebUrl: "www.lagou.com", HtmlToList: function () {
            return $("li .company_name a[data-lg-tj-cid]").closest("li")
        }, ItemToNameJq: function (n) {
            return $(n).find(".company_name a[data-lg-tj-cid]")
        }, NameJqToNameText: function (n) {
            return $(n).text()
        }, DleButtonToItem: function (n) {
            return $(n).closest("li")
        }, DleButtonStyle: "margin: 0 10px;display: inline-table;"
    }, {
        WebUrl: "www.liepin.com", HtmlToList: function () {
            return $("li .company-name a[title]").closest("li")
        }, ItemToNameJq: function (n) {
            return $(n).find(".company-name a[title]")
        }, NameJqToNameText: function (n) {
            return $(n).text()
        }, DleButtonToItem: function (n) {
            return $(n).closest("li")
        }, DleButtonStyle: "margin: 0 10px;display: inline-flex;position: absolute;right: 12px;"
    }];
    !function () {
        setTimeout(function () {
            for (var n = 0; n < v.length; n++) if (console.log(window.location.host), v[n].WebUrl === window.location.host) {
                h = v[n];
                break
            }
            o(), i()
        }, 5e3)
    }()
}();
